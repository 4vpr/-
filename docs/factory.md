
#  [ 팩토리 메서드 요약정리가 아닌 뻘글 일기장같은 무언가.md ]

ㅋㅋ 설마 내가 걸리겠어 절대 안걸리지 ㅋㅋㅋㅋ

## 팩토리 메서드가 뭐냐
객체 생성을 서브클래스에 위임하기 위한 추상 메서드를 정의한다.   
상위 클래스는 객체를 직접 생성하지 않고, 팩토리 메서드를 통해 객체를 생성하도록 규칙만 정한다.    
어떤 구체 클래스가 생성될지는 하위 클래스(구체 팩토리)가 결정한다.   

### 뭔소리고?
그니깐 부모 클래스를 상속받는 여러 클래스들이 있삼.  
근데 그 클래스를 상황에 맞는 자식 클래스를 골라서 인스턴스를 만들어야함.  
그래서 조건마다 if else 떡칠한다고 생각해보삼...  
완전 끔찍쓰... 그냥 코드리뷰때 개털리고 집가서 울고 다음날 회사 출근해서 눈 띵띵부어가지고 일도 안되고 직장 짤리고... 어휴 난 개발자는 못하겠다면서 편의점 알바 하게 되는것임...  

그니깐 그냥 클래스 생성 짬통을 만들자 <- 이게 팩토리 메서드  

근데 굳이 클래스 안만들고 전역함수 쓰면되는거아닌가? (진짜모름)  

전지전능 GPT 가라사데:  
위의 단점은 상태(state)를 가질 수 없음. (예: 공용 리소스 캐시, 로깅 같은 것)  
OOP 확장성 떨어짐. (상속, 다형성으로 갈아끼우는 구조 어려움)  
그렇다고 한다.  

## simple factory vs factory method

심플팩토리(짭토리메서드)는 그냥 팩토리 메서드에서 팩토리 클래스를 추상화하지 않고 간단하게 필요한 조건식들을 다 짬처리받아서 조건에 맞는 클래스를 돌려주기만 하면 된다. 장점으로는 클래스를 수천만개 만들지 않고 짜증나는 추상화를 안해도 되지만 새 자식 클래스가 생길때마다 직접 팩토리 클래스 코드를 수정해야하는 부담이 생김쓰. 솔직히 개인프로젝트만 하는데 이부분은 아직은 알빠노이다. 아무튼 코드의 재사용성을 줄여 줄 수 있다.

찐토리메서드는 팩토리 클래스를 추상화하고 각 자식 클래스마다 팩토리 클래스를 만들어야하는 아주번거로운 녀석이다. 어차피 분기는 똑같이 갈려서 갈리는 분기에 대한 조건식을 결국 if else로 갈라주어야 하지만 오늘도 '음 나는 멋지게 유지보수 할 수 있는 클린 코드를 작성했어' 같은 착각을 들게 해주는 장점이 있다.

## 언제씀?
위에서 설명하긴했지만 팩토리 메서드는 객체 생성에 조건이 필요하고 그것이 여러번 반복될때 쓰면 좋다.  

## 책의 예제만으로는 이해를 하지 못하는 이유
자꾸 책의 예제를 까게되는것 같은데 실제로 구리다. 추상화 잘하는법을 알려달라했는데 개념을 추상적으로 알려주고있다.  

마치 인벤 쌀숭이들이 비유를 하는것 같다. (비유법에 대한 비유라니)  

1. 실전 예시의 부재  
내가 계속 실전 예제에 대해 궁금해하고 실제로는 어디서 쓰이는지 찾았던 이유는 책의 예제상황은 *현실성*이 부족하여 와닿는 바가 없다고 느껴졌다.  

2. 이미 알고있어야 알아듣는 비유  
비유에는 두가지가 있다고 생각한다. 첫번째는 이미 해당 내용을 알고있는 사람들끼리 공감하기 위한 비유. 두번째는 해당내용에 문외한인 사람에게 쉽게 설명을 위해 비슷한 맥락을 공유하는 상황을 제시하는것이다. 책의 예제는 여러모로 첫번째에 가깝다는것이 내 생각. 애초에 개발을 배우려고 책을 보는건데 실전 예시가 더 적합하다고 생각한다.

## 나는 어떻게 써볼까?

내 게임에서도 쓸 수 있을지도??? (정말혼또니??)

내 게임에서 노트(리듬게임의 그것)은 종류가 8가지이다.
그것은 바로 일반노트 , 이동노트 , 트레이스 노트 , 장애물 까지 총 8가지가 있다.

그래서 이게 왜 8개인데?

그렇다 나는 숫자를 잘 셀 줄 모른다 농담이고 바로 인게임용 하고 맵을 편집하는 에디터용이 따로 있기 때문. 엄연히 업데이트 로직도 다르다.

### 지금은 어캐 구현했냐?

[4달전쯤에 만들어서](https://github.com/4vpr/Dansu/blob/master/scripts/chart/chart.gd) 까먹었었는데 방금 읽어보고 오니 이렇다:
note에 해당하는 node가 두개 있다.
그냥 note(인게임용)
editor_note(에디터용)
내가 아주 잘한포인트는 게임 씬의 루트 스크립트에서 판정관련 업데이트 펑션을 Array[node] 로
순차적으로 처리하며 스폰과 디스폰을 관리하기 때문에 매우매우 최적화 되어있다는 점이다.

해당 노드에는 각각 업데이트 로직이 있다.
그리고 chart에서 mapfile.json같은 맵파일을 파싱하는
```parse_json(is_editor:bool)```같은 펑션이 있다.

그래서 분기를
```var note_scene_to_use = note_scene_editor if is_editor else note_scene```
이렇게 나누고 있다.

사실 리펙토링 필요없는데 그냥 억지로 해보겠다.

### 리펙토링을 한다면?

여기서 팩토리 메서드를 쓰는건 진짜 '저 방금 팩토리 메서드 배웠어요' 하고 이마에 보드마커로 쓰는짓 같아서 대충 심플 팩토리로 해보자면 이런식이지 않을까 싶다. 실제로 코드를 재작성하거나 리펙토링할 생각은 아니기에 틀만 파이썬으로 그려보겠다.

```
class Note(node):

    def __init__(self,time,type,dir,rail):
        self.time = time
        self.type = type
        self.dir = dir
        self.rail = rail
    def ready():
        pass

    def update():
        pass

class Editor_note(note):
    ...중략...

class Ingame_note(note):
    ...중략...

class note_factory()
    def create_note(stage,time,type,dir,rail)
        if stage.name == "IN_GANE"
            return Ingame_note(time,type,dir,rail)
        if stage.name == "EDITOR"
            return Editor_note(note)

```